<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Werewolf Game</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #222;
        color: #fff;
      }

      #container {
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background-color: #333;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
      }

      input,
      button {
        margin-bottom: 10px;
        padding: 5px;
        border-radius: 3px;
        border: 1px solid #ccc;
        background-color: #444;
        color: #fff;
      }

      button {
        background-color: #007bff;
        color: #fff;
        border: none;
        cursor: pointer;
      }

      button:hover {
        background-color: #0056b3;
      }

      #players {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <h1>Mafia Game</h1>
      <div>
        <label for="code">Room Code:</label>
        <input
          type="text"
          id="code"
          placeholder="Enter room code"
          value="1234"
        />
        <label for="name">Your Name:</label>
        <input
          type="text"
          id="name"
          placeholder="Enter your name"
          value="Meet"
        />
        <button onclick="joinOrCreateRoom()">Join/Create Room</button>
      </div>
      <div id="players"></div>
      <div>
        <button onclick="startGame()">Start Game</button>
      </div>
    </div>
    <script>
      let url = "http://127.0.0.1:5000";
      let ishost = false;

      function joinOrCreateRoom() {
        var code = document.getElementById("code").value;
        var name = document.getElementById("name").value;
        fetch(`${url}/room/${code}/${name}`)
          .then((response) => response.json())
          .then((data) => {
            if (data.includes("Created")) {
              // You are the host, show all player names
              showPlayers();
            } else {
              // You are not the host, show "waiting for host to start" message
              showWaitingMessage();
            }
          });
      }

      function showWaitingMessage() {
        var playersDiv = document.getElementById("players");
        playersDiv.innerHTML = "";
        var p = document.createElement("p");
        p.textContent = "Waiting for host to start the game...";
        playersDiv.appendChild(p);
      }

      function startGame() {
        var code = document.getElementById("code").value;
        var name = document.getElementById("name").value;
        fetch(`${url}/start_game/${code}/${name}`)
          .then((response) => response.text())
          .then((data) => console.log(data));
      }

      var shownPlayers = false;
      function showPlayers() {
        if (shownPlayers) {
          return;
        }
        shownPlayers = true;
        var code = document.getElementById("code").value;
        if (code == "null") {
          code = "1234";
        }
        setInterval(() => {
          fetch(`${url}/players/${code}`)
            .then((response) => response.json())
            .then((data) => {
              var playersDiv = document.getElementById("players");
              playersDiv.innerHTML = "";
              data.forEach((player) => {
                var p = document.createElement("p");
                p.textContent = player;
                playersDiv.appendChild(p);
              });
            });
        }, 3000);
      }
    </script>
  </body>
</html>
